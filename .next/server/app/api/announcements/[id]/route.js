"use strict";(()=>{var e={};e.id=40,e.ids=[40],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},1737:e=>{e.exports=import("drizzle-orm")},1214:e=>{e.exports=import("drizzle-orm/node-postgres")},8025:e=>{e.exports=import("drizzle-orm/pg-core")},4939:e=>{e.exports=import("pg")},7598:e=>{e.exports=require("node:crypto")},2225:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{patchFetch:()=>c,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>p});var s=n(2706),a=n(8203),i=n(5994),o=n(38),u=e([o]);o=(u.then?(await u)():u)[0];let d=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/announcements/[id]/route",pathname:"/api/announcements/[id]",filename:"route",bundlePath:"app/api/announcements/[id]/route"},resolvedPagePath:"E:\\Project\\sst_announcement\\app\\api\\announcements\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:l,workUnitAsyncStorage:p,serverHooks:m}=d;function c(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:p})}r()}catch(e){r(e)}})},38:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{DELETE:()=>f,GET:()=>h,OPTIONS:()=>x,PATCH:()=>y});var s=n(9187),a=n(517),i=n(7644),o=n(4272),u=n(366),c=n(4218),d=n(1770),l=n(6980),p=n(1737),m=e([i,o,d,l,p]);function w(e){if(!e)throw new c.v7("Announcement ID is required");let t=Number(e);if(Number.isNaN(t))throw new c.v7("Announcement ID must be a valid number");return t}async function h(e,{params:t}){try{await (0,a.ay)(e,a.Nw);let{id:n}=await t,r=w(n),o=await (0,i.MZ)(r);if(!o)throw new c.m_("Announcement",r);return s.NextResponse.json({success:!0,data:o})}catch(e){return s.NextResponse.json({success:!1,error:e.message||"Internal server error"},{status:e.status||500})}}async function y(e,{params:t}){try{await (0,a.ay)(e,a.uZ);let n=await (0,o.oC)(e,{enforceDomain:!0});(0,u.eU)(n),(0,o.ZT)(n);let{id:r}=await t,m=w(r),h=await e.json(),y={};for(let[e,t]of Object.entries({title:"title",description:"description",category:"category",expiry_date:"expiryDate",scheduled_at:"scheduledAt",reminder_time:"reminderTime",is_active:"isActive",status:"status",priority_until:"priorityUntil"}))void 0!==h[e]&&(e.endsWith("_date")||e.endsWith("_at")||e.endsWith("_time")?y[t]=h[e]?new Date(h[e]):null:y[t]=h[e]);if(0===Object.keys(y).length)throw new c.v7("No fields to update");y.updatedAt=new Date;let f=(0,d.Lf)(),x=await f.update(l.announcements).set(y).where((0,p.eq)(l.announcements.id,m)).returning();if(0===x.length)throw new c.m_("Announcement",m);return s.NextResponse.json({success:!0,data:(0,i._n)(x[0])})}catch(e){return s.NextResponse.json({success:!1,error:e.message||"Internal server error"},{status:e.status||500})}}async function f(e,{params:t}){try{await (0,a.ay)(e,a.uZ);let n=await (0,o.oC)(e,{enforceDomain:!0});(0,u.eU)(n),(0,o.ZT)(n);let{id:r}=await t,i=w(r),m=(0,d.Lf)(),h=await m.delete(l.announcements).where((0,p.eq)(l.announcements.id,i)).returning({id:l.announcements.id});if(0===h.length)throw new c.m_("Announcement",i);return s.NextResponse.json({success:!0,data:{message:`Announcement with id ${i} deleted`}})}catch(e){return s.NextResponse.json({success:!1,error:e.message||"Internal server error"},{status:e.status||500})}}async function x(){return new s.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, PATCH, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}[i,o,d,l,p]=m.then?(await m)():m,r()}catch(e){r(e)}})},7644:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{MZ:()=>d,_n:()=>u,ir:()=>c});var s=n(1737),a=n(1770),i=n(6980),o=e([s,a,i]);function u(e){return{id:e.id,title:e.title,description:e.description,category:e.category,author_id:e.authorId,created_at:e.createdAt,updated_at:e.updatedAt,expiry_date:e.expiryDate,scheduled_at:e.scheduledAt,reminder_time:e.reminderTime,is_active:e.isActive,status:e.status,views_count:e.viewsCount,clicks_count:e.clicksCount,send_email:e.sendEmail,email_sent:e.emailSent,priority_until:e.priorityUntil}}async function c(e){let t=(0,a.Lf)().select().from(i.announcements).orderBy((0,s.desc)(i.announcements.createdAt));return e?.limit!==void 0&&(t=t.limit(e.limit)),e?.offset!==void 0&&(t=t.offset(e.offset)),(await t).map(u)}async function d(e){let t=(0,a.Lf)(),n=await t.select().from(i.announcements).where((0,s.eq)(i.announcements.id,e)).limit(1);return n.length>0?u(n[0]):null}[s,a,i]=o.then?(await o)():o,r()}catch(e){r(e)}})},517:(e,t,n)=>{n.d(t,{Nw:()=>i,ay:()=>a,uZ:()=>o});var r=n(4218);let s=new Map;async function a(e,t){let n=function(e){let t=e.headers.get("x-forwarded-for");return t?t.split(",")[0]?.trim()||"unknown":e.headers.get("x-real-ip")||e.ip||"unknown"}(e),a=`${t.keyPrefix}:${n}`,i=Date.now(),o=s.get(a);if(!o||o.expiresAt<i){s.set(a,{count:1,expiresAt:i+t.windowMs});return}if(o.count>=t.max)throw new r.qQ("Too many requests, please try again later.");o.count+=1,s.set(a,o)}let i={windowMs:9e5,max:100,keyPrefix:"general"},o={windowMs:9e5,max:200,keyPrefix:"admin"}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[680,38,883,684],()=>n(2225));module.exports=r})();