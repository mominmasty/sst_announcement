"use strict";(()=>{var e={};e.id=426,e.ids=[426],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},1737:e=>{e.exports=import("drizzle-orm")},1214:e=>{e.exports=import("drizzle-orm/node-postgres")},8025:e=>{e.exports=import("drizzle-orm/pg-core")},4939:e=>{e.exports=import("pg")},7598:e=>{e.exports=require("node:crypto")},8633:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{patchFetch:()=>u,routeModule:()=>p,serverHooks:()=>c,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>l});var s=r(2706),a=r(8203),i=r(5994),o=r(2438),d=e([o]);o=(d.then?(await d)():d)[0];let p=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/dashboard/route",pathname:"/api/admin/dashboard",filename:"route",bundlePath:"app/api/admin/dashboard/route"},resolvedPagePath:"E:\\Project\\sst_announcement\\app\\api\\admin\\dashboard\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:m,workUnitAsyncStorage:l,serverHooks:c}=p;function u(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:l})}n()}catch(e){n(e)}})},2438:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{GET:()=>p,OPTIONS:()=>m});var s=r(9187),a=r(517),i=r(4272),o=r(366),d=r(4172),u=e([i,d]);async function p(e){try{await (0,a.ay)(e,a.uZ);let t=await (0,i.oC)(e,{enforceDomain:!0});(0,o.eU)(t),(0,i.ZT)(t);let r=await (0,d.CF)(),n=r.reduce((e,t)=>{let r=t.role||"student";return e[r]=(e[r]||0)+1,e},{student:0,student_admin:0,admin:0,super_admin:0}),u=r.slice(0,5).map(e=>({...e,role:e.role||"student",role_display:"super_admin"===e.role?"Super Admin":"admin"===e.role?"Admin":"student_admin"===e.role?"Student Admin":"Student"}));return s.NextResponse.json({success:!0,data:{totalUsers:r.length,studentUsers:n.student,studentAdminUsers:n.student_admin,adminUsers:n.admin,superAdminUsers:n.super_admin,recentUsers:u,roleBreakdown:{student:n.student,student_admin:n.student_admin,admin:n.admin,super_admin:n.super_admin},endpoints:{getAllUsers:"GET /api/admin/users",getUserById:"GET /api/admin/users/:id",updateAdminStatus:"PATCH /api/admin/users/:id/admin-status",updateUserRole:"PATCH /api/admin/users/:id/role",searchUser:"GET /api/admin/users?email=example@email.com"}}})}catch(e){return s.NextResponse.json({success:!1,error:e.message||"Internal server error"},{status:e.status||500})}}async function m(){return new s.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}[i,d]=u.then?(await u)():u,n()}catch(e){n(e)}})},517:(e,t,r)=>{r.d(t,{Nw:()=>i,ay:()=>a,uZ:()=>o});var n=r(4218);let s=new Map;async function a(e,t){let r=function(e){let t=e.headers.get("x-forwarded-for");return t?t.split(",")[0]?.trim()||"unknown":e.headers.get("x-real-ip")||e.ip||"unknown"}(e),a=`${t.keyPrefix}:${r}`,i=Date.now(),o=s.get(a);if(!o||o.expiresAt<i){s.set(a,{count:1,expiresAt:i+t.windowMs});return}if(o.count>=t.max)throw new n.qQ("Too many requests, please try again later.");o.count+=1,s.set(a,o)}let i={windowMs:9e5,max:100,keyPrefix:"general"},o={windowMs:9e5,max:200,keyPrefix:"admin"}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[680,38,883,684],()=>r(8633));module.exports=n})();